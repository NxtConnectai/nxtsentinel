# ============================================================================
# NXT Sentinel Marketing Website - Firebase Hosting Deployment
# ============================================================================
# This workflow automatically deploys the marketing website to Firebase Hosting
# when changes are pushed to the main branch.
#
# Required GitHub Secrets:
#   - FIREBASE_SERVICE_ACCOUNT: Service account JSON for Firebase deployment
#
# Setup Instructions:
#   1. Go to Firebase Console > Project Settings > Service Accounts
#   2. Click "Generate new private key"
#   3. Copy the entire JSON content
#   4. Go to GitHub repo > Settings > Secrets > Actions
#   5. Create new secret named FIREBASE_SERVICE_ACCOUNT
#   6. Paste the JSON content as the value
# ============================================================================

name: Deploy to Firebase Hosting

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Deploy to Firebase Hosting (Production)
      # Only runs on push to main branch
      - name: Deploy to Firebase Hosting (Production)
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
          channelId: live
          projectId: ${{ secrets.FIREBASE_PROJECT_ID }}

      # Step 3: Deploy Preview Channel (for Pull Requests)
      # Creates a unique preview URL for each PR
      - name: Deploy Preview Channel
        if: github.event_name == 'pull_request'
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
          projectId: ${{ secrets.FIREBASE_PROJECT_ID }}
          # Preview channel expires after 7 days
          expires: 7d

